<?phprequire_once('models/model.php');require_once('models/M_Users.php');class C_Page extends C_Base{	private $model;	private $user;	public function __construct()	{		$this->model = Model::getInstance();		$this->user = M_Users::Instance();	}	public function actionIndex() {		$this->title .= 'Главная';		$result = $this->model->getAllFromTable('blog');		$this->content = $this->Template('views/index.php', array('result' => $result, 'online' => $this->user->IsOnline($this->user->GetUid())));	}		public function actionEdit() {		$this->title .= 'Редактирование статьи';		if (isset($_GET['id'])) {			$id = htmlspecialchars($_GET['id']);			if (isset($_POST['submitArticle'])) {				$this->model->update('blog',$_POST, ' id = '.$id);			}			if (!empty($id)) {				$article = $this->model->getOneRow($id);			}		}		$this->content = $this->Template('views/edit.php', ['article' => $article, 'online' => $this->user->IsOnline($this->user->GetUid())]);	}	public function actionNew() {		$this->title = 'Новая статья';		if (isset($_POST['submitAdd'])) {			$this->model->insert($_POST, 'blog');		}		$this->content = $this->Template('views/new.php', ['online' => $this->user->IsOnline($this->user->GetUid())]);	}	public function actionReg() {		$this->title = 'Регистрация';		if (isset($_POST['submitReg'])) {			$_POST['password'] = md5($_POST['password']);			$this->model->Insert($_POST, 'users');		}		$this->content = $this->Template('views/reg.php', ['online' => $this->user->IsOnline($this->user->GetUid())]);	}	public function actionLogin() {		$this->title = 'Авторизация';		if (isset($_POST['submitLogin'])) {			$this->user->Login($_POST['login'], $_POST['password']);		}		$this->content = $this->Template('views/login.php', ['online' => $this->user->IsOnline($this->user->GetUid())]);	}	public function actionEditor() {		$this->title = 'Консоль администратора';		$articles = $this->model->getAllFromTable('blog');		$this->content = $this->Template('views/editor.php', ['articles' => $articles, 'online' => $this->user->IsOnline($this->user->GetUid())]);	}	public function actionDel() {		$this->model->Delete('comments', 'blog_id = '.$_GET['id']);		$this->model->Delete('blog', 'id = '.$_GET['id']);		$this->actionEditor();	}	public function actionArticle() {		if (isset($_GET['id'])) {			$id = htmlspecialchars($_GET['id']);			if (!empty($id)) {				$article = $this->model->getOneRow($id);				$comments = $this->model->getAllFromTableByFID('comments', ['blog_id' => $id]);			}		}		$this->title = 'Детальная страница статьи';		$this->content = $this->Template('views/article.php', ['article' => $article, 'comments' => $comments, 'online' => $this->user->IsOnline($this->user->GetUid())]);	}	public function actionComment() {		if (isset($_POST['submitAdd'])) {			$this->model->insert([				'author' => $_POST['author'],				'blog_id' => $_GET['id'],				'text' => $_POST['text'],			], 'comments');		}		$this->actionArticle();	}}